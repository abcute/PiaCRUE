# Crafting & Problem-Solving World Environment: Design Specification

**Document Version:** 1.0
**Date:** 2024-08-06
**Author:** PiaAGI Project Contributors (Generated by Jules)
**Status:** Draft

## 1. Introduction and Purpose

*   **Purpose:** This environment is designed to facilitate research into complex agent behaviors such as:
    *   Multi-step planning and problem decomposition.
    *   Resource gathering and management.
    *   Inventory management.
    *   Recipe-based crafting.
    *   Tool selection, use, and potentially conceptual tool creation/adaptation.
    *   Goal-directed behavior in a constructive setting where the agent must create items to solve problems or achieve objectives.
*   **Scope:** A simulated world where agents can navigate locations, find resources, use tools, operate crafting stations, and craft a variety of items based on known or discoverable recipes to overcome challenges or meet defined goals.

## 2. Core Components and State Representation

### 2.1. World State
*   **Locations (`world_map`):**
    *   Description: Textual description of each location.
    *   Resources: Dictionary of resource types and available quantities (e.g., `{"wood": 10, "stone": 5}`). Resources can be finite or replenishable (conceptual extension).
    *   Crafting Stations: List of station types available at the location (e.g., `["workbench", "forge"]`).
    *   Tools Present: List of tools available for pickup at the location (e.g., `["axe", "pickaxe"]`). (New concept compared to basic CraftingWorld)
    *   Environmental Features/Obstacles (Conceptual Extension): Specific features that might require tools or crafted items to interact with (e.g., "dense_thicket_requiring_axe", "locked_chest_requiring_key").
    *   Exits: Connections to other locations. (Currently implicit in `CraftingWorld`, could be explicit).
*   **Recipes (`known_recipes` in agent, could also be discoverable in world):**
    *   Structure: `{"output_item_name": {"inputs": {"ingredient_name": quantity}, "station_required": "station_type" or None, "tool_required": "tool_type" or None, "output_quantity": quantity}}`. (Added `tool_required`).
*   **Items (Resources, Tools, Craftable Objects):**
    *   Properties: Name, type (resource, tool, craftable), durability (for tools - conceptual extension), effects (if tool or special item - conceptual extension).

### 2.2. Agent State
*   **Location (`agent_location`):** Current location ID of the agent.
*   **Inventory (`agent_inventory`):** Dictionary of item names and quantities held by the agent. Includes resources, tools, and crafted items.
*   **Known Recipes (`known_recipes`):** Recipes the agent currently knows.
*   **Active Tool (Conceptual Extension):** The tool currently "equipped" or being actively used by the agent.
*   **Agent Goals/Tasks (Conceptual Extension for environment-defined goals):** List of tasks assigned by the environment/scenario that the agent needs to complete (e.g., `{"task_id": "craft_wooden_bridge", "required_item": "wooden_bridge", "status": "pending"}`).

## 3. Perception Data Provided to Agent

*   **Current Location Info:** (As in current `CraftingWorld`)
    *   Location ID, description.
    *   Available resources (name, quantity).
    *   Available crafting stations.
    *   Tools present for pickup.
    *   Exits.
*   **Inventory Contents:** (As in current `CraftingWorld`).
*   **Known Recipes List:** (As in current `CraftingWorld`).
*   **Active Tool (Conceptual Extension):** Name of the tool currently equipped by the agent.
*   **Environmental Goals/Tasks (Conceptual Extension):** Description of active tasks assigned by the environment, their requirements, and status.
*   **Feedback from Last Action:** Success/failure message, items gained/lost. (As in `ActionResult.message` and updated perception).
*   **Conceptual Future Extensions:**
    *   Percepts related to tool durability.
    *   Information about environmental features/obstacles at the current location.

## 4. Action Space for Agent

*   **`navigate(target_location_id: str)`:** Move to a different location. (Current)
*   **`gather_resource(resource_type: str, quantity: int, tool_used: Optional[str] = None)`:**
    *   Gather specified quantity of a resource.
    *   **Enhancement:** Some resources might require a specific `tool_used` (e.g., "axe" for "wood", "pickaxe" for "ore"). Gathering efficiency or success might depend on the tool. (Tool use is new).
*   **`craft_item(item_name: str, recipe_to_use: Optional[Dict] = None, tool_used: Optional[str] = None)`:**
    *   Craft an item using a known recipe. `recipe_to_use` could allow specifying which recipe if multiple produce the same item.
    *   **Enhancement:** Some recipes might require a specific `tool_used` at a crafting station (e.g., "hammer" at "workbench"). (Tool use is new).
*   **`pickup_tool(tool_name: str)` (New Action):** Add a tool from the current location to agent's inventory.
*   **`equip_tool(tool_name: str)` (Conceptual New Action):** Designate a tool from inventory as the active tool. (Needed if actions depend on an active tool).
*   **`interact_feature(feature_id: str, tool_used: Optional[str] = None)` (Conceptual New Action):** Interact with an environmental feature/obstacle, possibly requiring a tool.

## 5. Environment Dynamics

### 5.1. Resource Management
*   Resources at locations are finite and deplete upon gathering. (Current)
*   Conceptual: Some resources might regenerate over time or under certain conditions.

### 5.2. Crafting Logic
*   Checks agent's known recipes. (Current)
*   Consumes input ingredients from agent's inventory. (Current)
*   Checks for required crafting station at agent's current location. (Current)
*   **Enhancement:** Checks for required tool in agent's inventory (or if equipped).
*   Adds output item(s) to agent's inventory on success. (Current)

### 5.3. Tool Mechanics (New)
*   **Tool Requirement:** Certain actions (`gather_resource`, `craft_item`, `interact_feature`) may fail or be inefficient if the correct tool is not used (or equipped and in inventory).
*   **Tool Durability (Conceptual Extension):** Tools might have durability that depletes with use and can break. Agent might need to craft new tools or repair them.
*   **Tool Effects (Conceptual Extension):** Specific tools might enable unique interactions or provide bonuses (e.g., "magic_axe" gathers enchanted_wood).

### 5.4. Problem Solving & Goal Progression (New/Conceptual)
*   Scenarios can define overarching goals (e.g., "Craft Item X," "Reach Location Y by overcoming Obstacle Z").
*   The environment can track the status of these goals based on agent actions and world state.
*   The `is_done()` method should reflect the completion state of these scenario-defined goals.

## 6. Scenario Definition

Scenarios should be configurable to create diverse crafting and problem-solving challenges.
*   **Initial World State:**
    *   Definition of locations, initial resources, tools present, crafting stations.
    *   Agent's starting location.
*   **Initial Agent State:**
    *   Initial inventory (could be empty or include starting items/tools).
    *   Initial known recipes.
*   **Scenario Goals (New):**
    *   A list of objectives for the agent to achieve.
        *   Example: `{"goal_id": "build_shelter", "type": "craft_specific_item", "item_name": "wooden_shelter_kit", "target_quantity": 1}`
        *   Example: `{"goal_id": "cross_river", "type": "overcome_obstacle", "obstacle_id": "broken_bridge", "solution_item": "bridge_repair_kit"}`
*   **Available Recipes:** All recipes potentially learnable or usable in the scenario (agent might start with a subset).

## 7. Future Development and Extensions

*   Discoverable recipes (e.g., found in the world or by experimentation).
*   Tool durability and repair mechanics.
*   More complex environmental interactions and puzzles.
*   NPCs that might provide quests, trade resources, or offer crafting services.
*   Procedurally generated worlds or problem sets.
*   Integration with PiaAVT for analyzing problem-solving strategies, resource management efficiency, etc.

This design document provides a blueprint for developing the Crafting & Problem-Solving World into a rich environment for AGI research, building upon the existing `crafting_world.py` implementation.
