<!-- PiaAGI Research Tools - PiaAVT -->
# PiaAGI Logging Specification for PiaAVT

**Date:** November 23, 2024
**Author:** PiaAGI Project Contributors (Generated by Jules)
**Status:** Draft
**Related Documents:**
*   [PiaAGI Agent Analysis & Visualization Toolkit (PiaAVT) Conceptual Design](PiaAGI_Agent_Analysis_Visualization_Toolkit.md)
*   [PiaAGI Cognitive Module Library (PiaCML) README](../PiaCML/README.md)
*   [PiaAGI Simulation Environment (PiaSE) Conceptual Design](../PiaAGI_Simulation_Environment.md)

## 1. Introduction

This document specifies the standardized logging format and schema for components within the PiaAGI framework, including Cognitive Module Library (CML) modules and the PiaAGI Simulation Environment (PiaSE). The primary consumer of these logs is the PiaAGI Agent Analysis & Visualization Toolkit (PiaAVT), which will use this data for analysis, visualization, debugging, and evaluation of PiaAGI agents.

A consistent logging format is crucial for:
*   **Interoperability:** Ensuring logs from different sources can be easily combined and processed.
*   **Analysis Automation:** Allowing PiaAVT to reliably parse and interpret log data.
*   **Debugging:** Providing detailed traces of agent behavior and internal states.
*   **Reproducibility:** Capturing sufficient information to understand and potentially replicate experimental outcomes.

## 2. Logging Format: JSON Lines (JSONL)

The standard logging format adopted is **JSON Lines (JSONL)**.
*   Each log entry is a single, self-contained JSON object.
*   Each JSON object is written on a new line (newline delimited).

**Rationale for JSONL:**
*   **Structured Data:** JSON allows for complex, nested data structures within each log entry, suitable for capturing rich event details.
*   **Streamable & Appendable:** New log entries can be easily appended to a file. Log processors can read and parse entries line by line, making it efficient for large log files.
*   **Widely Supported:** JSON is a ubiquitous data interchange format with excellent parsing library support in most programming languages, including Python.
*   **Human-Readable (Moderately):** While potentially verbose, JSON is more human-readable than binary formats, aiding manual inspection during debugging.
*   **Scalability:** Well-suited for ingestion into log management and analysis platforms (e.g., Elasticsearch, Splunk, cloud-based logging services).

## 3. Standard Log Entry Schema

Each JSON log entry MUST adhere to the following top-level schema:

```json
{
  "timestamp": "YYYY-MM-DDTHH:MM:SS.ffffffZ", // ISO 8601 format, UTC
  "simulation_run_id": "string",
  "experiment_id": "string",
  "agent_id": "string",
  "source_component_id": "string",
  "log_level": "string",
  "event_type": "string",
  "event_data": {} // Flexible JSON object
}
```

### 3.1. Top-Level Field Descriptions

*   **`timestamp`** (String, ISO 8601 Format, UTC):
    *   The precise time at which the event occurred or was logged.
    *   Format: `YYYY-MM-DDTHH:MM:SS.ffffffZ` (e.g., `"2024-11-23T10:30:01.123456Z"`).
    *   Using UTC is mandatory to ensure global consistency.
*   **`simulation_run_id`** (String):
    *   A unique identifier for a single, complete execution of a simulation or experimental run.
    *   Allows filtering and grouping of all logs related to one specific instance of an agent performing a task in an environment.
*   **`experiment_id`** (String):
    *   An identifier for a set of related `simulation_run_id`s, often used for parameter sweeps, A/B testing different agent configurations, or replications of the same experimental setup.
*   **`agent_id`** (String):
    *   A unique identifier for the specific PiaAGI agent instance generating the log or being the subject of the log. Crucial for multi-agent simulations.
*   **`source_component_id`** (String):
    *   A hierarchical string identifying the precise source of the log entry within the PiaAGI architecture.
    *   Examples:
        *   `"PiaCML.ConcreteLongTermMemoryModule_Semantic_Main"`
        *   `"PiaCML.ConcreteWorkingMemoryModule_Agent01.CentralExecutive"`
        *   `"PiaSE.Environment_TextWorldV1"`
        *   `"PiaAGI.CoreAgentLoop"`
*   **`log_level`** (String):
    *   Indicates the severity or verbosity of the log entry. Recommended levels:
        *   `"TRACE"`: Very detailed information about execution flow (e.g., method calls, fine-grained steps).
        *   `"DEBUG"`: Information useful for debugging specific modules or behaviors.
        *   `"INFO"`: General operational information about the system's progress and significant events.
        *   `"STATE"`: Snapshots of important module states at critical junctures or regular intervals.
        *   `"WARN"`: Potential issues, unexpected situations, or minor errors that were handled.
        *   `"ERROR"`: Errors that occurred but might not have halted the entire simulation.
        *   `"CRITICAL"`: Severe errors that likely led to simulation termination or major malfunction.
*   **`event_type`** (String):
    *   A standardized, controlled vocabulary string that categorizes the nature of the logged event. This field is critical for PiaAVT to filter, aggregate, and trigger specific analyses.
    *   A list of recommended `event_type`s is provided in Section 4.
*   **`event_data`** (JSON Object):
    *   A flexible JSON object containing data specific to the `event_type` and `source_component_id`.
    *   The structure of this object will vary widely. Section 5 provides examples.

## 4. Recommended `event_type` Categories

This is a non-exhaustive list of recommended `event_type` categories. Projects may extend this with more specific types, but adherence to these general categories where applicable will aid PiaAVT.

*   **Module Lifecycle:**
    *   `MODULE_INITIALIZED`
    *   `MODULE_CONFIGURED`
    *   `MODULE_RESET`
    *   `MODULE_TERMINATED`
*   **Method/Function Calls (for TRACE level):**
    *   `MODULE_METHOD_CALL`
    *   `MODULE_METHOD_RETURN`
*   **State Changes:**
    *   `STATE_UPDATE` (generic)
    *   `WM_ITEM_ADDED`, `WM_ITEM_REMOVED`, `WM_FOCUS_SET`
    *   `LTM_STORE_ATTEMPT`, `LTM_STORE_SUCCESS`, `LTM_STORE_FAIL`
    *   `LTM_RETRIEVAL_ATTEMPT`, `LTM_RETRIEVAL_SUCCESS`, `LTM_RETRIEVAL_FAIL`
    *   `GOAL_CREATED`, `GOAL_ACTIVATED`, `GOAL_STATUS_CHANGED`, `GOAL_ACHIEVED`, `GOAL_FAILED`
    *   `EMOTION_APPRAISAL_TRIGGERED`, `EMOTION_STATE_UPDATED`
    *   `PLAN_GENERATED`, `PLAN_SELECTED`, `PLAN_EXECUTING_STEP`, `PLAN_COMPLETED`, `PLAN_FAILED`
    *   `SELFMODEL_ATTRIBUTE_UPDATED`, `SELFMODEL_CONFIDENCE_CHANGED`
    *   `WORLDMODEL_ENTITY_UPDATED`, `WORLDMODEL_CONSISTENCY_CHECK`
    *   `TOM_INFERENCE_MADE`, `TOM_AGENT_MODEL_UPDATED`
*   **Perception & Action:**
    *   `PERCEPTION_INPUT_RECEIVED` (raw input)
    *   `PERCEPTION_INPUT_PROCESSED` (structured output from perception module)
    *   `BEHAVIOR_COMMAND_ISSUED` (from BehaviorGeneration to environment/actuators)
    *   `AGENT_ACTION_SENT_TO_ENV` (PiaSE perspective)
    *   `AGENT_ACTION_EXECUTED_IN_ENV` (PiaSE perspective, with outcome)
*   **Environment Events (from PiaSE):**
    *   `ENVIRONMENT_STATE_CHANGED`
    *   `ENVIRONMENT_EVENT_OCCURRED` (e.g., non-agent initiated)
    *   `REWARD_SIGNAL_ISSUED`
    *   `TASK_STATUS_UPDATE` (e.g., task started, task completed)
*   **Communication:**
    *   `NLU_OUTPUT_GENERATED`
    *   `NLG_INPUT_RECEIVED`
    *   `NLG_OUTPUT_GENERATED`
    *   `COMMUNICATION_STRATEGY_APPLIED`
*   **Learning & Adaptation:**
    *   `LEARNING_EPISODE_START`, `LEARNING_EPISODE_END`
    *   `MODEL_PARAMETER_UPDATE` (e.g., weights in a neural component)
    *   `KNOWLEDGE_CONSOLIDATION_EVENT`
    *   `PREDICTION_ERROR_DETECTED`
*   **System & Errors:**
    *   `SYSTEM_MESSAGE`
    *   `MODULE_WARNING`
    *   `MODULE_ERROR`
    *   `SIMULATION_CONTROL` (e.g., pause, resume, end)
*   **Meta-Cognitive and Self-Development Events (New Section):**
    *   `MCP_DEFINITION_REQUESTED`: Agent identifies a need for a Meta-Cognitive Primitive (MCP) to solve a class of problems or improve a process.
    *   `MCP_GENERATED`: Agent successfully generates or defines a new MCP.
    *   `MCP_MODIFIED`: Agent modifies an existing MCP based on experience or reflection.
    *   `MCP_INVOKED`: Agent invokes/applies an MCP to a specific situation or problem.
    *   `SELF_REFLECTION_TRIGGERED`: A specific event, internal state, or query triggers a self-reflection process.
    *   `SELF_REFLECTION_INSIGHT`: An insight, conclusion, or hypothesis generated during self-reflection.
    *   `SELF_CORRECTION_INITIATED`: Agent identifies a flaw in its knowledge, reasoning, or behavior and initiates a correction process.
    *   `SELF_CORRECTION_APPLIED`: Agent applies a specific correction or modification.
    *   `INTERNAL_SIMULATION_START`: Agent begins an internal "thought experiment" or simulation of a scenario.
    *   `INTERNAL_SIMULATION_STEP`: A significant step or event within an ongoing internal simulation.
    *   `INTERNAL_SIMULATION_OUTCOME`: The outcome or conclusion reached from an internal simulation.
    *   `AGENT_TOOL_DESIGN_PROPOSED`: Agent proposes the design for a new internal "tool," cognitive strategy, or heuristic.
    *   `AGENT_TOOL_CREATED`: Agent finalizes the creation or implementation of an internal tool/strategy.
    *   `AGENT_TOOL_MODIFIED`: Agent modifies an existing internal tool/strategy.
    *   `AGENT_TOOL_USED`: Agent utilizes one of its internal tools/strategies in a specific context.
    *   `COGNITIVE_RECONFIGURATION_PROPOSED`: Agent considers significant changes to its own cognitive architecture, parameters, or process flows.
    *   `COGNITIVE_RECONFIGURATION_APPLIED`: Agent implements changes to its cognitive architecture or core processing.
    *   `LEARNING_STRATEGY_SELECTED`: Agent explicitly selects or switches its current learning strategy or approach.
    *   `KNOWLEDGE_GAP_IDENTIFIED`: Agent explicitly identifies a gap in its knowledge base or understanding related to a specific topic or goal.
    *   `EXPLANATION_GENERATED_SELF`: Agent generates an explanation for its own behavior or reasoning, for internal review or potential future use.


## 5. Example Log Entries

Below are illustrative examples. Refer to these when implementing logging within CML modules or PiaSE.

**(Assume `simulation_run_id: "run_20241123_103000"`, `experiment_id: "exp_basic_interaction_001"`, `agent_id: "PiaAgent_Alpha01"` for brevity in examples below, but they should be present in actual logs.)**

**1. Perception Module - Processing User Input**
```json
{
  "timestamp": "2024-11-23T10:30:01.123456Z",
  "simulation_run_id": "run_20241123_103000",
  "experiment_id": "exp_basic_interaction_001",
  "agent_id": "PiaAgent_Alpha01",
  "source_component_id": "PiaCML.ConcretePerceptionModule_1",
  "log_level": "INFO",
  "event_type": "PERCEPTION_INPUT_PROCESSED",
  "event_data": {
    "modality": "text",
    "raw_input": "Pia, tell me about a red apple.",
    "parsed_output": {
      "intent": "request_information",
      "entities": [
        {"name": "apple", "type": "object", "attributes": ["red"]}
      ],
      "confidence": 0.92
    }
  }
}
```

**2. Working Memory - Item Added**
```json
{
  "timestamp": "2024-11-23T10:30:01.125000Z",
  "simulation_run_id": "run_20241123_103000",
  "experiment_id": "exp_basic_interaction_001",
  "agent_id": "PiaAgent_Alpha01",
  "source_component_id": "PiaCML.ConcreteWorkingMemoryModule_Main",
  "log_level": "TRACE",
  "event_type": "WM_ITEM_ADDED",
  "event_data": {
    "item_id": "wm_perception_001",
    "content_summary": {"intent": "request_information", "entities_count": 1},
    "initial_salience": 0.9,
    "buffer_size_after_add": 1
  }
}
```

**3. Long-Term Memory - Semantic Retrieval Success**
```json
{
  "timestamp": "2024-11-23T10:30:01.530000Z",
  "simulation_run_id": "run_20241123_103000",
  "experiment_id": "exp_basic_interaction_001",
  "agent_id": "PiaAgent_Alpha01",
  "source_component_id": "PiaCML.ConcreteLongTermMemoryModule_Semantic",
  "log_level": "DEBUG",
  "event_type": "LTM_RETRIEVAL_SUCCESS",
  "event_data": {
    "memory_type": "semantic",
    "query": {"concept": "apple", "attributes": ["red"]},
    "results_count": 5,
    "retrieved_ids_summary": ["fact_apple_is_fruit", "fact_apple_grows_tree", "..."],
    "retrieval_time_ms": 45.7
  }
}
```

**4. Motivational System - Goal Activated**
```json
{
  "timestamp": "2024-11-23T10:30:02.010000Z",
  "simulation_run_id": "run_20241123_103000",
  "experiment_id": "exp_basic_interaction_001",
  "agent_id": "PiaAgent_Alpha01",
  "source_component_id": "PiaCML.ConcreteMotivationalSystem_Core",
  "log_level": "INFO",
  "event_type": "GOAL_ACTIVATED",
  "event_data": {
    "goal_id": "goal_inform_user_001",
    "goal_type": "extrinsic_task",
    "description": "Provide information about 'red apple' to user.",
    "priority": 0.85,
    "source_trigger_event_id": "wm_perception_001" // Reference to the WM item that triggered this
  }
}
```

**5. Planning Module - Plan Selected**
```json
{
  "timestamp": "2024-11-23T10:30:02.250000Z",
  "simulation_run_id": "run_20241123_103000",
  "experiment_id": "exp_basic_interaction_001",
  "agent_id": "PiaAgent_Alpha01",
  "source_component_id": "PiaCML.ConcretePlanningAndDecisionMakingModule_Default",
  "log_level": "INFO",
  "event_type": "PLAN_SELECTED",
  "event_data": {
    "plan_id": "plan_describe_apple_001",
    "goal_id_associated": "goal_inform_user_001",
    "confidence_score": 0.9,
    "summary_of_steps": ["select_facts_from_ltm", "structure_response_content", "delegate_to_communication"],
    "evaluation_metrics": {"expected_utility": 10.5, "estimated_duration_ms": 500}
  }
}
```

**6. Emotion Module - State Update**
```json
{
  "timestamp": "2024-11-23T10:30:02.300000Z",
  "simulation_run_id": "run_20241123_103000",
  "experiment_id": "exp_basic_interaction_001",
  "agent_id": "PiaAgent_Alpha01",
  "source_component_id": "PiaCML.ConcreteEmotionModule_Standard",
  "log_level": "DEBUG",
  "event_type": "EMOTION_STATE_UPDATED",
  "event_data": {
    "previous_vad": {"valence": 0.1, "arousal": 0.05, "dominance": 0.1},
    "current_vad": {"valence": 0.15, "arousal": 0.1, "dominance": 0.1},
    "current_discrete_emotion": "NEUTRAL_INTEREST",
    "trigger_event_summary": "Successful information retrieval for user query."
  }
}
```

**7. PiaSE - Agent Action Executed in Environment**
```json
{
  "timestamp": "2024-11-23T10:30:02.810000Z",
  "simulation_run_id": "run_20241123_103000",
  "experiment_id": "exp_basic_interaction_001",
  "agent_id": "PiaAgent_Alpha01",
  "source_component_id": "PiaSE.Environment_TextSim_Instance01",
  "log_level": "INFO",
  "event_type": "AGENT_ACTION_EXECUTED_IN_ENV",
  "event_data": {
    "agent_id_acting": "PiaAgent_Alpha01",
    "action_details": {"type": "speak", "content_length": 145, "recipient": "user001"},
    "environmental_outcome_summary": "Text message successfully displayed to user interface."
  }
}
```

**8. Meta-Cognitive - MCP Generated (New Example)**
```json
{
  "timestamp": "2024-11-24T11:00:00.000Z",
  "simulation_run_id": "run_mcp_dev_001",
  "experiment_id": "exp_mcp_learning_002",
  "agent_id": "PiaAgent_Beta02",
  "source_component_id": "PiaCML.SelfModelModule_CognitiveControl",
  "log_level": "INFO",
  "event_type": "MCP_GENERATED",
  "event_data": {
    "mcp_id": "mcp_resource_allocation_v1",
    "description": "Dynamically allocate cognitive resources based on task priority and estimated complexity.",
    "source_problem_id": "problem_context_multi_task_inefficiency_004",
    "complexity_score": 0.75,
    "parameters": [{"name": "max_tasks", "type": "int", "default": 3}, {"name": "priority_threshold", "type": "float", "default": 0.8}],
    "expected_outcome": "Improved throughput on high-priority tasks."
  }
}
```

**9. Meta-Cognitive - Self-Correction Initiated (New Example)**
```json
{
  "timestamp": "2024-11-24T11:05:00.000Z",
  "simulation_run_id": "run_mcp_dev_001",
  "experiment_id": "exp_mcp_learning_002",
  "agent_id": "PiaAgent_Beta02",
  "source_component_id": "PiaCML.SelfModelModule_ReflectionEngine",
  "log_level": "INFO",
  "event_type": "SELF_CORRECTION_INITIATED",
  "event_data": {
    "trigger_event_id": "ltm_retrieval_fail_087",
    "identified_flaw_description": "Repeated failure to retrieve 'concept_X' when context is 'context_Y', suggesting poor indexing or association.",
    "proposed_correction_strategy": "Re-index 'concept_X' with additional keywords from 'context_Y'; strengthen association between 'concept_X' and 'related_concept_Z'.",
    "target_module_for_correction": "PiaCML.ConcreteLongTermMemoryModule_Semantic"
  }
}
```

**10. Meta-Cognitive - Agent Tool Used (New Example)**
```json
{
  "timestamp": "2024-11-24T11:10:00.000Z",
  "simulation_run_id": "run_mcp_dev_001",
  "experiment_id": "exp_mcp_learning_002",
  "agent_id": "PiaAgent_Beta02",
  "source_component_id": "PiaCML.PlanningModule_StrategyApplier",
  "log_level": "DEBUG",
  "event_type": "AGENT_TOOL_USED",
  "event_data": {
    "tool_id": "tool_analogy_mapper_v1.2",
    "tool_name": "Analogy Mapping Strategy",
    "input_parameters": {
      "source_domain_problem_id": "problem_A_solved_001",
      "target_domain_problem_id": "problem_B_current_005"
    },
    "outcome_summary": "Successfully mapped 2 core structural elements and proposed 1 candidate solution for problem_B.",
    "confidence_in_outcome": 0.65,
    "execution_time_ms": 120
  }
}
```

## 6. Implementation Guidelines for Log Producers (CML Modules, PiaSE)

*   **Timestamping:** Log events as close to their occurrence as possible. Use `time.time()` for Unix timestamp and convert to ISO 8601 UTC.
*   **Component IDs:** Ensure `source_component_id` is specific enough to identify the instance if multiple instances of the same module type exist.
*   **`event_data` Richness:** Provide sufficient detail in `event_data` for PiaAVT to perform meaningful analysis. Avoid overly verbose data that could bloat logs unnecessarily (e.g., logging entire memory dumps frequently). Summaries or key identifiers are often preferred.
*   **Error Handling:** Wrap logging calls in `try-except` blocks if there's any risk of the logging process itself failing and disrupting core agent logic.
*   **Configurable Log Levels:** Implementations should respect a global or per-module log level configuration, allowing researchers to control verbosity.

## 7. Future Evolution

This logging specification is a starting point. It will evolve as:
*   PiaCML modules become more sophisticated.
*   PiaSE environments and scenarios grow in complexity.
*   The analytical capabilities of PiaAVT are developed, potentially requiring new `event_type`s or `event_data` structures.

Changes to this specification should be versioned and communicated to maintain compatibility.

---
Return to [PiaAVT Conceptual Design](PiaAGI_Agent_Analysis_Visualization_Toolkit.md)
Return to [PiaAGI Research Tools README](../README.md)
Return to [PiaAGI Core Document](../../PiaAGI.md)
