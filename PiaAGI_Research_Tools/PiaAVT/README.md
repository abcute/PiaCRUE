<!-- PiaAGI AGI Research Framework Document -->
# PiaAGI Agent Analysis & Visualization Toolkit (PiaAVT)

This directory contains the PiaAGI Agent Analysis & Visualization Toolkit (PiaAVT), a Python-based toolkit designed to assist in understanding and evaluating PiaAGI agents.

PiaAVT provides tools to log, analyze, and visualize agent behavior, internal cognitive states (conceptualized), learning trajectories, and developmental progress.

Refer to the main conceptual design document at [../../PiaAGI_Hub/PiaAGI_Agent_Analysis_Visualization_Toolkit.md](../../PiaAGI_Hub/PiaAGI_Agent_Analysis_Visualization_Toolkit.md) for the overarching purpose and goals of PiaAVT.

## Logging Specification

PiaAVT processes logs that adhere to a defined standard. This specification is crucial for ensuring that data generated by PiaCML modules and PiaSE can be correctly ingested and analyzed.

For details on the standard log format, schema, recommended event types, and example log entries, please refer to the **[PiaAGI Logging Specification for PiaAVT](Logging_Specification.md)**.

## Current Features (Initial Build)

*   **Logging System (`core/logging_system.py`):** Ingestion, validation, and storage of JSON logs.
*   **Analyzers (`analyzers/`):**
    *   `basic_analyzer.py`: Log filtering, descriptive statistics, time-series extraction, unique value counting.
    *   `event_sequencer.py`: Extracts defined event sequences with time/intervening log constraints.
*   **Visualization Components (`visualizers/`):**
    *   `timeseries_plotter.py`: Matplotlib-based time-series plots with optional `mplcursors` interactivity.
    *   `state_visualizer.py`: Textual representations of agent states.
*   **API (`api.py`):** `PiaAVTAPI` facade for programmatic access.
*   **Command-Line Interface (`cli.py`):** CLI access to core functionalities.
*   **WebApp (`webapp/app.py`):** Streamlit PoC for interactive analysis (log upload, stats, plotting, sequences, basic raw log view).
*   **Examples (`examples/`):** Scripts demonstrating API and CLI usage.
*   **Unit Tests (`tests/`):** For core components, analyzers, CLI, and visualizers.
*   **Requirements (`requirements.txt`):** Lists Python dependencies.

## Architecture Overview

PiaAVT is structured into several key components:
-   **`core/`**: `logging_system.py` for log handling.
-   **`analyzers/`**: `basic_analyzer.py`, `event_sequencer.py` for data analysis.
-   **`visualizers/`**: `timeseries_plotter.py`, `state_visualizer.py` for generating visualizations.
-   **`api.py`**: The `PiaAVTAPI` class, the main programmatic entry point.
-   **`cli.py`**: The command-line interface script.
-   **`webapp/`**: Contains the Streamlit web application (`app.py`).
-   **`examples/`**: Practical usage scripts.
-   **`tests/`**: `unittest`-based test suites.
-   **`requirements.txt`**: Python dependencies file.

## Basic Usage (API)

Programmatic interaction is via the `PiaAVTAPI` class:
```python
from PiaAGI_Hub.PiaAVT.api import PiaAVTAPI # Ensure PYTHONPATH is set if needed
api = PiaAVTAPI()
if api.load_logs_from_json("path/to/logs.json"):
    stats = api.get_stats_for_field("data.reward", event_type="Action")
    if stats: api.display_formatted_dict(stats, title="Reward Stats")
```
See `examples/` for more.

## Command-Line Interface (CLI) Usage

PiaAVT includes `cli.py` for quick analysis.
1.  Navigate to `PiaAGI_Hub/PiaAVT`.
2.  Run: `python cli.py <command> [options]`
    *   Load: `python cli.py load path/to/your/logs.json`
    *   Stats: `python cli.py stats data.reward --event_type Action`
Use `python cli.py <command> -h` for help. See `examples/example_cli_usage.sh`.

## WebApp Setup and Usage

The PiaAVT WebApp provides an interactive way to analyze logs. It is built using Streamlit.

### Dependencies

The main Python dependencies for the WebApp and the PiaAVT toolkit are listed in `PiaAGI_Hub/PiaAVT/requirements.txt`. Key dependencies include:
-   `streamlit`
-   `pandas`
-   `matplotlib`
-   `mplcursors` (optional, for enhanced plot interactivity in the WebApp)

### Setup and Running

1.  **Navigate to the PiaAVT root directory:**
    Open your terminal and change to the directory where you cloned or placed the PiaAVT project.
    ```bash
    cd path/to/your/PiaAGI_Hub/PiaAVT
    ```

2.  **Create and activate a Python virtual environment (Recommended):**
    It's highly recommended to use a virtual environment to manage project dependencies and avoid conflicts with other Python projects.
    ```bash
    # Create a virtual environment named '.venv' in the current directory
    python -m venv .venv
    ```
    Activate the virtual environment:
    ```bash
    # On Windows (Git Bash or PowerShell):
    # source .venv/Scripts/activate
    # (If using Command Prompt: .venv\Scripts\activate.bat)

    # On macOS/Linux:
    source .venv/bin/activate
    ```
    Your terminal prompt should change to indicate that the virtual environment is active (e.g., `(.venv) your-prompt$`).

3.  **Install dependencies:**
    With the virtual environment activated, install the required packages from the `requirements.txt` file:
    ```bash
    pip install -r requirements.txt
    ```

4.  **Run the Streamlit WebApp:**
    Ensure you are still in the `PiaAGI_Hub/PiaAVT` directory (where `requirements.txt` and the `webapp` folder are located).
    ```bash
    streamlit run webapp/app.py
    ```
    Streamlit will start a local web server and typically open the application in your default web browser automatically. If not, it will display a local URL (e.g., `http://localhost:8501`) that you can open manually.

### Basic Features

Once the WebApp is running in your browser:
-   **Upload Logs:** Use the sidebar to upload your agent's log file in JSON format.
-   **Global Filters:** After loading logs, you can use the sidebar to filter logs by source, event type, or timestamp range. These filters generally apply to the "Overview & Stats", "Time Series Plot", and "Raw Logs" tabs.
-   **Overview & Stats Tab:** View a summary of the loaded logs, including total entries and unique source/event type counts. You can also calculate and display descriptive statistics for specific data fields.
-   **Time Series Plot Tab:** Generate line plots for numeric data fields over time. You can specify the field path, title, and Y-axis label. If `mplcursors` is installed, plots offer interactive tooltips.
-   **Event Sequences Tab:** Define patterns of events (as JSON or comma-separated event types) and find occurrences of these sequences in your logs. You can also set constraints like maximum time between steps. (Note: Global filters from the sidebar currently do not apply to this specific feature.)
-   **Raw Logs Tab:** Provides a basic interface to view a limited number of raw log entries in JSON format.

### Troubleshooting

-   **Import Errors (`ModuleNotFoundError` for `PiaAVT` components):**
    The WebApp (`webapp/app.py`) is designed to be run when your terminal's current working directory is `PiaAGI_Hub/PiaAVT`. This allows its internal relative imports (e.g., `from PiaAVT.api import PiaAVTAPI`) to work correctly.
    If you encounter `ModuleNotFoundError` (e.g., "No module named 'PiaAVT'"), it usually means you are running the `streamlit run` command from a different directory.

    **Solution:**
    1.  **Recommended:** Always navigate to the `PiaAGI_Hub/PiaAVT` directory first, then run `streamlit run webapp/app.py`.
    2.  **Alternative (Advanced):** If you must run it from elsewhere, you would need to add the `PiaAGI_Hub` directory (the parent of `PiaAVT`) to your `PYTHONPATH` environment variable so that Python can find the `PiaAVT` package.
        For example, if `PiaAGI_Hub` is at `/path/to/PiaAGI_Hub`:
        ```bash
        # On macOS/Linux (temporary for the current session)
        export PYTHONPATH="/path/to/PiaAGI_Hub:$PYTHONPATH"
        # On Windows (Command Prompt, temporary for the current session)
        # set PYTHONPATH="C:\path\to\PiaAGI_Hub;%PYTHONPATH%"
        ```
        Then you could potentially run `streamlit run /path/to/your/PiaAGI_Hub/PiaAVT/webapp/app.py`. However, running from the project's intended root (`PiaAGI_Hub/PiaAVT`) is simpler and less prone to path issues.

-   **`mplcursors` not found:** If you see a message in the application or console about `mplcursors` not being found and wish to enable interactive plot tooltips, install it into your activated virtual environment:
    ```bash
    pip install mplcursors
    ```
    Then, restart the Streamlit application.

## Advanced Configuration and Extensibility

### Managing API Keys and External Services (Conceptual)

While the current version of PiaAVT primarily focuses on analyzing local log data and does not directly integrate with external services like Large Language Models (LLMs) that require API keys, the broader PiaAGI project envisions components that might.

For future extensions or related PiaAGI tools that might require such integrations, a common approach for managing API keys and service endpoints would be recommended:

1.  **Environment Variables:** Store API keys and sensitive configuration in environment variables (e.g., `OPENAI_API_KEY`, `PIA_CUSTOM_SERVICE_ENDPOINT`). This is a secure and flexible method, as keys are not hardcoded into the source.
    *   Example: `export OPENAI_API_KEY="your_actual_key_here"`
2.  **Configuration Files:** Use a dedicated configuration file (e.g., `.env` files loaded by a library like `python-dotenv`, or a `config.toml`/`config.yaml` file) to store these settings. These files should be added to `.gitignore` to prevent accidental versioning of secrets.
    *   Example (`.env` file):
        ```
        OPENAI_API_KEY="your_actual_key_here"
        LLAMA_API_ENDPOINT="https://api.example.com/llama"
        ```
    *   Example (`config.toml`):
        ```toml
        [api_keys]
        openai = "your_actual_key_here"

        [service_endpoints]
        my_custom_model = "https://custom.api/v1"
        ```
3.  **Application Access:** The application code would then securely load these configurations at runtime, typically defaulting to environment variables first, then checking configuration files.

This approach ensures that users can easily and securely configure any necessary credentials or endpoints without modifying the core codebase, facilitating easier deployment and maintenance across different environments and for various users. PiaAVT itself may adopt such a system if it evolves to directly support analyses requiring external API calls.

## Future Development

Future enhancements may include:
-   Support for more log input formats (e.g., CSV, direct streaming).
-   Advanced analysis techniques (e.g., anomaly detection, comparative analysis).
-   More sophisticated visualization types (e.g., network graphs for memory/social models).
-   A graphical user interface (GUI) for easier interaction (the WebApp is a first step).
-   Integration with databases for larger log datasets.
-   More robust CLI argument parsing, especially for complex inputs like sequence definitions.
-   Refinement of global filter application across all WebApp features.
-   Creation of a `requirements.txt` for easier dependency management (Done).
-   Configuration management for external services if PiaAVT expands to use them.

Contributions are welcome! Please see the main project's `CONTRIBUTING.md`.
```

---
Return to [PiaAGI Core Document](../../PiaAGI.md) | [Project README](../../README.md)
